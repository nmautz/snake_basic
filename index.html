<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Snake!</title>


  <style>


    .cell{

      width: 40px;
      height: 40px;
      background-color: grey;
    }

    .snake{
      background-color: green !important;
    }

    .snake-head{
      background-color: rgb(0, 63, 0);
    }

    .fruit{

      background-color: blueviolet;


    }

    
  </style>

  <script>


    function create_board(width, height){


      const game_table = document.getElementById("game")

      for(let i = 0; i < height; ++i){

        const tr = document.createElement('tr')
        for(let c = 0; c < width; ++c){
          const td = document.createElement('td')
          td.classList.add('cell')
          tr.appendChild(td)
        }

        game_table.appendChild(tr)

      }
      
    }

    function get_cell(x,y){

      const game_table = document.getElementById("game")
      let rows = game_table.childNodes
      let cols = rows[rows.length-y].childNodes
      return cols[x-1]



    }

    function place_fruit(){
      let locY = Math.floor(Math.random() * b_height)
      let locX = Math.floor(Math.random() * b_width)

      fruit_cell = [locX, locY]
      console.log(fruit_cell)

      console.log("cell: " + get_cell(locX,locY))

      get_cell(locX, locY).classList.add('fruit')



    }


    function setup_snake(){

      snake_head = [5,5]
      snake_body = [[5,5], [5,5]]
      snake_direction = 'right'

    }

    function clear_board(){
      const game_table = document.getElementById("game")
      while(game_table.childNodes[0] != undefined){
        game_table.childNodes[0].remove()
      }
      


    }

    function move_snake(){

      console.log(snake_direction)
      let movement = [0,0]
      if(snake_direction == 'left'){
        movement = [-1,0]
      }else if(snake_direction == 'right'){
        movement = [1,0]
      }else if(snake_direction == 'up'){
        movement = [0,1]
      }else{
        movement = [0,-1]
      }



      snake_body.push([snake_head[0], snake_head[1]])
      snake_body.shift()
      snake_head[0] += movement[0]
      snake_head[1] += movement[1]

      console.log(snake_body)


    }

    function update_board(input){


      //check snake cant turn around
      console.log(input)
      if(input != -1){
        snake_direction = input
      }
      console.log(snake_direction)
      move_snake()

      clear_board()
      create_board(b_width, b_height)

      get_cell(snake_head[0], snake_head[1]).classList.add('snake-head')
      for(let i = 0; i < snake_body.length; ++i){
        get_cell(snake_body[i][0], snake_body[i][1]).classList.add('snake')
      }
      place_fruit()


      



    }

    function get_input(){

      let up_count = 0
      let left_count = 0
      let right_count  = 0
      let down_count = 0


      for(const input of event_queue){

        if(input== 37){
          left_count++
        }else if(input==39){
          right_count++

        }else if(input==40){
          down_count++
        }else if(input==38){
          up_count++
        }

        
      }


      let max = Math.max(up_count,down_count,left_count,right_count)
      if(event_queue.length ==0){
        return -1
      }
      event_queue = []


      if(left_count == max){
        return 'left'
      }else if(right_count==max){
        return 'right'
      }else if(up_count ==max){
        return 'up'
      }else if(down_count == max){
        return 'down'
      }else{
        return -1
      }

    }

    var event_queue = []

    document.addEventListener("keydown", (event)=>{

      console.log(event.keyCode)
      event_queue.push(event.keyCode)
      //event.preventDefault()


    })

    document.addEventListener("DOMContentLoaded", ()=>{


      const start_btn = document.getElementById("start-btn")

      const height_input = document.getElementById("height-input")
      const width_input = document.getElementById("width-input")
      start_btn.addEventListener("click", ()=>{

        b_height = height_input.value
        b_width = width_input.value

        create_board(b_width, b_height)
        setup_snake()


        let game_loop = setInterval(() => {
          
          let input = get_input()
          update_board(input)

        }, 700);



      })

  



    })



  </script>



</head>
<body>
  

  <p>Score: 0</p>

  <table id="game">

  </table>


  <fieldset style="background-color: grey;">
    <p>Width</p>
    <input id="width-input" value="15">
    <p>Height</p>
    <input id="height-input" value="15">
    <button id="start-btn">Start Game</button>


  </fieldset>




</body>
</html>